name: nginx
on:
  workflow_dispatch:
    inputs:
      version:
        description: 'nginx version'
        required: true
        default: ''
      install:
        description: 'nginx install dir'
        required: false
        default: '/opt/local/nginx'

jobs:
  nginx:
    runs-on: ubuntu-18.04
    strategy:
      matrix:
        platform: [linux/amd64]
        os: [16.04, 18.04]
    steps:
    - name: Checkout
      timeout-minutes: 1
      uses: actions/checkout@v2
      with:
        persist-credentials: false

    - name: Setup
      uses: docker/setup-buildx-action@v1
      with:
        install: true

    - name: Build with ubuntu_${{matrix.os}} ${{matrix.platform}}
      id: build
      timeout-minutes: 10
      run: |
        docker run -v ${PWD}:/app --platform ${{matrix.platform}} ubuntu:${{matrix.os}} \
        bash /app/script/nginx.sh ${{secrets.GIT_TOKEN}} ${{github.event.inputs.version}} ${{github.event.inputs.install}} 1
      shell: bash

#    - name: Release
#      timeout-minutes: 1
#      if: ${{ success() && env.DEB }}
#      uses: svenstaro/upload-release-action@v2
#      with:
#        repo_token: ${{ secrets.GIT_TOKEN }}
#        file: ${{github.workspace}}/nginx_*
#        asset_name: ${{env.DEB}}
#        tag: ${{env.TAG}}
#        overwrite: true
#        body: "release ${{env.TAG}} install in ${{github.event.inputs.install}}"
#        file_glob: true